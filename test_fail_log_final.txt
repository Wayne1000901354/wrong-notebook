
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mD:/MyApp/wrong-notebook[39m

[90mstderr[2m | src/__tests__/unit/ai/gemini-retry.test.ts[2m > [22m[2mGeminiProvider Retry Logic[2m > [22m[2mshould retry on network error and eventually succeed
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

 [32mâœ“[39m src/__tests__/unit/logger.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 68[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/config.test.ts[2m > [22m[2mconfig module[2m > [22m[2mgetAppConfig[2m > [22m[2måº”è¯¥åœ¨é…ç½®æ–‡ä»¶è§£æå¤±è´¥æ—¶è¿”å›é»˜è®¤å€¼
[22m[39m[2m[11:32:30.741][0m [31mERROR[0m [34m(config)[0m: Failed to read config file
    [2merror:[0m [37mUnexpected token 'i', "invalid json{" is not valid JSON[0m

[90mstderr[2m | src/__tests__/unit/config.test.ts[2m > [22m[2mconfig module[2m > [22m[2mupdateAppConfig[2m > [22m[2måº”è¯¥åœ¨å†™å…¥å¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯
[22m[39m[2m[11:32:30.746][0m [31mERROR[0m [34m(config)[0m: Failed to write config file
    [2merror:[0m [37mPermission denied[0m

 [31mâ¯[39m src/__tests__/unit/ai/azure-provider.test.ts [2m([22m[2m30 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 17[2mms[22m[39m
       [32mâœ“[39m ç¼ºå°‘ API Key æ—¶åº”è¯¥æŠ›å‡º AI_AUTH_ERROR[32m 2[2mms[22m[39m
       [32mâœ“[39m API Key ä¸ºç©ºå­—ç¬¦ä¸²æ—¶åº”è¯¥æŠ›å‡º AI_AUTH_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m ç¼ºå°‘ endpoint æ—¶åº”è¯¥æŠ›å‡º AI_AUTH_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m endpoint ä¸ºç©ºå­—ç¬¦ä¸²æ—¶åº”è¯¥æŠ›å‡º AI_AUTH_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m ç¼ºå°‘ deploymentName æ—¶åº”è¯¥æŠ›å‡º AI_AUTH_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m deploymentName ä¸ºç©ºå­—ç¬¦ä¸²æ—¶åº”è¯¥æŠ›å‡º AI_AUTH_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m æœ‰æ•ˆé…ç½®æ—¶åº”è¯¥æˆåŠŸåˆ›å»ºå®ä¾‹[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥ä½¿ç”¨é»˜è®¤ API ç‰ˆæœ¬[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥æ”¯æŒè‡ªå®šä¹‰ API ç‰ˆæœ¬[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥æ”¯æŒè‡ªå®šä¹‰ model æ˜¾ç¤ºåç§°[32m 0[2mms[22m[39m
       [32mâœ“[39m analyzeImage æ–¹æ³•åº”è¯¥å­˜åœ¨å¹¶ä¸”æ˜¯å‡½æ•°[32m 0[2mms[22m[39m
       [32mâœ“[39m generateSimilarQuestion æ–¹æ³•åº”è¯¥å­˜åœ¨å¹¶ä¸”æ˜¯å‡½æ•°[32m 0[2mms[22m[39m
       [32mâœ“[39m reanswerQuestion æ–¹æ³•åº”è¯¥å­˜åœ¨å¹¶ä¸”æ˜¯å‡½æ•°[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m åº”è¯¥æ­£ç¡®è§£æåŒ…å«æ‰€æœ‰å¿…éœ€æ ‡ç­¾çš„å“åº”[39m[32m 6[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥æ­£ç¡®å¤„ç† requiresImage ä¸º false[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥æ­£ç¡®å¤„ç†æ— æ•ˆå­¦ç§‘è¿”å›é»˜è®¤å€¼"å…¶ä»–"[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥æ­£ç¡®åˆ†å‰²çŸ¥è¯†ç‚¹(é€—å·åˆ†éš”)[32m 1[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥æ­£ç¡®åˆ†å‰²çŸ¥è¯†ç‚¹(ä¸­æ–‡é€—å·åˆ†éš”)[32m 0[2mms[22m[39m
       [32mâœ“[39m ç¼ºå°‘å¿…éœ€æ ‡ç­¾æ—¶åº”è¯¥æŠ›å‡ºé”™è¯¯[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥æ­£ç¡®æå–æ ‡ç­¾å†…å®¹[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥å»é™¤é¦–å°¾ç©ºæ ¼[32m 0[2mms[22m[39m
       [32mâœ“[39m æ ‡ç­¾ä¸å­˜åœ¨æ—¶åº”è¯¥è¿”å› null[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥å¤„ç†å¤šè¡Œå†…å®¹[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥å°†ç½‘ç»œé”™è¯¯è½¬æ¢ä¸º AI_CONNECTION_FAILED[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥å°†è¿æ¥é”™è¯¯è½¬æ¢ä¸º AI_CONNECTION_FAILED[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥å°†è®¤è¯é”™è¯¯è½¬æ¢ä¸º AI_AUTH_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥å°† 401 é”™è¯¯è½¬æ¢ä¸º AI_AUTH_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m åº”è¯¥å°† JSON è§£æé”™è¯¯è½¬æ¢ä¸º AI_RESPONSE_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m æœªçŸ¥é”™è¯¯åº”è¯¥è½¬æ¢ä¸º AI_UNKNOWN_ERROR[32m 0[2mms[22m[39m
       [32mâœ“[39m é Error å¯¹è±¡åº”è¯¥è½¬æ¢ä¸º AI_UNKNOWN_ERROR[32m 0[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/config.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 22[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2måº”è¯¥ç”Ÿæˆä¸­æ–‡æç¤ºè¯
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2måº”è¯¥ç”Ÿæˆè‹±æ–‡æç¤ºè¯
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2mæ‡‰è©²åŒ…å«å­¸ç§‘æç¤ºï¼ˆå¦‚æœæä¾›ï¼‰
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2mæ‡‰è©²æ ¹æ“šå¹´ç´šéæ¿¾æ•¸å­¸æ¨™ç±¤ï¼ˆåˆä¸€ï¼‰
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2mæ‡‰è©²æ ¹æ“šå¹´ç´šéæ¿¾æ•¸å­¸æ¨™ç±¤ï¼ˆåˆä¸‰ï¼‰
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2mæ‡‰è©²æ ¹æ“šå¹´ç´šéæ¿¾æ•¸å­¸æ¨™ç±¤ï¼ˆé«˜ä¸€ï¼‰
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2måº”è¯¥æ”¯æŒè‡ªå®šä¹‰é€‰é¡¹ (providerHints)
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2måº”è¯¥æ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai-prompts.test.ts[2m > [22m[2mAI Prompts[2m > [22m[2mgenerateAnalyzePrompt[2m > [22m[2mç”Ÿæˆçš„æç¤ºè©ä¸æ‡‰åŒ…å«æœªæ›¿æ›çš„è®Šé‡ä½”ä½ç¬¦
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

 [32mâœ“[39m src/__tests__/unit/ai-prompts.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/middleware.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/auth-utils.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/ai/providers.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 335[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸé‡æ–°å›ç­”é—®é¢˜
[22m[39m[2m[11:32:30.994][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸé‡æ–°å›ç­”é—®é¢˜
[22m[39m[2m[11:32:30.996][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m12[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸé‡æ–°å›ç­”é—®é¢˜
[22m[39m[2m[11:32:30.997][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

 [32mâœ“[39m src/__tests__/unit/utils.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/grade-calculator.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒæŒ‡å®šå­¦ç§‘
[22m[39m[2m[11:32:30.999][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒæŒ‡å®šå­¦ç§‘
[22m[39m[2m[11:32:31.000][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m54[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mè‹±è¯­[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒæŒ‡å®šå­¦ç§‘
[22m[39m[2m[11:32:31.000][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒé™„å¸¦å›¾ç‰‡
[22m[39m[2m[11:32:31.003][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒé™„å¸¦å›¾ç‰‡
[22m[39m[2m[11:32:31.003][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m10[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mæ•°å­¦[0m
    [2mhasImage:[0m [37mtrue[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒé™„å¸¦å›¾ç‰‡
[22m[39m[2m[11:32:31.003][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒè‹±æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.004][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒè‹±æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.005][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m16[0m
    [2mlanguage:[0m [37men[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ”¯æŒè‹±æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.005][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥é»˜è®¤ä½¿ç”¨ä¸­æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.006][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥é»˜è®¤ä½¿ç”¨ä¸­æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.006][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m4[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥é»˜è®¤ä½¿ç”¨ä¸­æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.006][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»ç©ºçš„é¢˜ç›®æ–‡æœ¬
[22m[39m[2m[11:32:31.007][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»ç©ºçš„é¢˜ç›®æ–‡æœ¬
[22m[39m[2m[11:32:31.007][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m0[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»ç©ºçš„é¢˜ç›®æ–‡æœ¬
[22m[39m[2m[11:32:31.007][0m [33mWARN [0m [34m(api:reanswer)[0m: Missing question text

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»åªæœ‰ç©ºæ ¼çš„é¢˜ç›®æ–‡æœ¬
[22m[39m[2m[11:32:31.008][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»åªæœ‰ç©ºæ ¼çš„é¢˜ç›®æ–‡æœ¬
[22m[39m[2m[11:32:31.008][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m3[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»åªæœ‰ç©ºæ ¼çš„é¢˜ç›®æ–‡æœ¬
[22m[39m[2m[11:32:31.008][0m [33mWARN [0m [34m(api:reanswer)[0m: Missing question text

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»ç¼ºå°‘é¢˜ç›®æ–‡æœ¬çš„è¯·æ±‚
[22m[39m[2m[11:32:31.009][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»ç¼ºå°‘é¢˜ç›®æ–‡æœ¬çš„è¯·æ±‚
[22m[39m[2m[11:32:31.009][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mPOST /api/reanswer (é‡æ–°å›ç­”é—®é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»ç¼ºå°‘é¢˜ç›®æ–‡æœ¬çš„è¯·æ±‚
[22m[39m[2m[11:32:31.009][0m [33mWARN [0m [34m(api:reanswer)[0m: Missing question text

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI è®¤è¯é”™è¯¯
[22m[39m[2m[11:32:31.010][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI è®¤è¯é”™è¯¯
[22m[39m[2m[11:32:31.010][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m4[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI è®¤è¯é”™è¯¯
[22m[39m[2m[11:32:31.013][0m [31mERROR[0m [34m(api:reanswer)[0m: Reanswer error occurred
    [2merror:[0m [37mAI_AUTH_ERROR: Invalid API key[0m
    [2mstack:[0m [37mError: AI_AUTH_ERROR: Invalid API key
    at D:/MyApp/wrong-notebook/src/__tests__/integration/reanswer.test.ts:239:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI è¿æ¥é”™è¯¯
[22m[39m[2m[11:32:31.014][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI è¿æ¥é”™è¯¯
[22m[39m[2m[11:32:31.014][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m4[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI è¿æ¥é”™è¯¯
[22m[39m[2m[11:32:31.014][0m [31mERROR[0m [34m(api:reanswer)[0m: Reanswer error occurred
    [2merror:[0m [37mAI_CONNECTION_FAILED[0m
    [2mstack:[0m [37mError: AI_CONNECTION_FAILED
    at D:/MyApp/wrong-notebook/src/__tests__/integration/reanswer.test.ts:260:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI å“åº”é”™è¯¯
[22m[39m[2m[11:32:31.015][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI å“åº”é”™è¯¯
[22m[39m[2m[11:32:31.015][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m4[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç† AI å“åº”é”™è¯¯
[22m[39m[2m[11:32:31.015][0m [31mERROR[0m [34m(api:reanswer)[0m: Reanswer error occurred
    [2merror:[0m [37mAI_RESPONSE_ERROR[0m
    [2mstack:[0m [37mError: AI_RESPONSE_ERROR
    at D:/MyApp/wrong-notebook/src/__tests__/integration/reanswer.test.ts:281:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç†å…¶ä»–æœªçŸ¥é”™è¯¯
[22m[39m[2m[11:32:31.016][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ†æå›¾åƒ
[22m[39m[2m[11:32:31.018][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç†å…¶ä»–æœªçŸ¥é”™è¯¯
[22m[39m[2m[11:32:31.016][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m4[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç†å…¶ä»–æœªçŸ¥é”™è¯¯
[22m[39m[2m[11:32:31.016][0m [31mERROR[0m [34m(api:reanswer)[0m: Reanswer error occurred
    [2merror:[0m [37mUnknown error occurred[0m
    [2mstack:[0m [37mError: Unknown error occurred
    at D:/MyApp/wrong-notebook/src/__tests__/integration/reanswer.test.ts:302:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ†æå›¾åƒ
[22m[39m[2m[11:32:31.020][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m47[0m
    [2mmimeType:[0m [37mimage/png[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.020][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m25[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç†æ²¡æœ‰é”™è¯¯æ¶ˆæ¯çš„å¼‚å¸¸
[22m[39m[2m[11:32:31.017][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ†æå›¾åƒ
[22m[39m[2m[11:32:31.020][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.020][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç†æ²¡æœ‰é”™è¯¯æ¶ˆæ¯çš„å¼‚å¸¸
[22m[39m[2m[11:32:31.017][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m4[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ†æå›¾åƒ
[22m[39m[2m[11:32:31.020][0m [36mDEBUG[0m [34m(api:analyze)[0m: AI returned knowledge points
    [2mknowledgePointsCount:[0m [37m2[0m
    [2mknowledgePointsType:[0m [37mobject[0m
    [2misArray:[0m [37mtrue[0m
[2m[11:32:31.020][0m [32mINFO [0m [34m(api:analyze)[0m: AI analysis successful

[90mstderr[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2mé”™è¯¯å¤„ç†[2m > [22m[2måº”è¯¥å¤„ç†æ²¡æœ‰é”™è¯¯æ¶ˆæ¯çš„å¼‚å¸¸
[22m[39m[2m[11:32:31.017][0m [31mERROR[0m [34m(api:reanswer)[0m: Reanswer error occurred
    [2merror:[0m [37m[0m
    [2mstack:[0m [37mError: 
    at D:/MyApp/wrong-notebook/src/__tests__/integration/reanswer.test.ts:322:68
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†é•¿æ–‡æœ¬é¢˜ç›®
[22m[39m[2m[11:32:31.018][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†é•¿æ–‡æœ¬é¢˜ç›®
[22m[39m[2m[11:32:31.018][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m169[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mæ•°å­¦[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†é•¿æ–‡æœ¬é¢˜ç›®
[22m[39m[2m[11:32:31.018][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„é¢˜ç›®
[22m[39m[2m[11:32:31.018][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„é¢˜ç›®
[22m[39m[2m[11:32:31.018][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m24[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mundefined[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„é¢˜ç›®
[22m[39m[2m[11:32:31.018][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†åŒ…å« LaTeX çš„é¢˜ç›®
[22m[39m[2m[11:32:31.019][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer API called

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†åŒ…å« LaTeX çš„é¢˜ç›®
[22m[39m[2m[11:32:31.019][0m [36mDEBUG[0m [34m(api:reanswer)[0m: Reanswer request received
    [2mquestionLength:[0m [37m22[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubject:[0m [37mæ•°å­¦[0m
    [2mhasImage:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/reanswer.test.ts[2m > [22m[2m/api/reanswer[2m > [22m[2må¤æ‚åœºæ™¯[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†åŒ…å« LaTeX çš„é¢˜ç›®
[22m[39m[2m[11:32:31.019][0m [32mINFO [0m [34m(api:reanswer)[0m: Reanswer successful

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒ Data URL æ ¼å¼çš„å›¾åƒ
[22m[39m[2m[11:32:31.022][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

 [32mâœ“[39m src/__tests__/integration/reanswer.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒ Data URL æ ¼å¼çš„å›¾åƒ
[22m[39m[2m[11:32:31.022][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m44[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.022][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/jpeg[0m
    [2mbase64Length:[0m [37m21[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒ Data URL æ ¼å¼çš„å›¾åƒ
[22m[39m[2m[11:32:31.023][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.023][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstderr[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒ Data URL æ ¼å¼çš„å›¾åƒ
[22m[39m[2m[11:32:31.023][0m [33mWARN [0m [34m(api:analyze)[0m: Knowledge points is empty or null

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒ Data URL æ ¼å¼çš„å›¾åƒ
[22m[39m[2m[11:32:31.023][0m [36mDEBUG[0m [34m(api:analyze)[0m: AI returned knowledge points
    [2mknowledgePointsCount:[0m [37m0[0m
    [2mknowledgePointsType:[0m [37mobject[0m
    [2misArray:[0m [37mtrue[0m
[2m[11:32:31.023][0m [32mINFO [0m [34m(api:analyze)[0m: AI analysis successful

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ‹’ç»ç¼ºå°‘å›¾åƒæ•°æ®çš„è¯·æ±‚
[22m[39m[2m[11:32:31.024][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ‹’ç»ç¼ºå°‘å›¾åƒæ•°æ®çš„è¯·æ±‚
[22m[39m[2m[11:32:31.024][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37mundefined[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m

[90mstderr[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ‹’ç»ç¼ºå°‘å›¾åƒæ•°æ®çš„è¯·æ±‚
[22m[39m[2m[11:32:31.024][0m [33mWARN [0m [34m(api:analyze)[0m: Missing image data

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å…³è”åˆ°æŒ‡å®šçš„ç§‘ç›®
[22m[39m[2m[11:32:31.025][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å…³è”åˆ°æŒ‡å®šçš„ç§‘ç›®
[22m[39m[2m[11:32:31.025][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37msubject-physics-id[0m
[2m[11:32:31.025][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å…³è”åˆ°æŒ‡å®šçš„ç§‘ç›®
[22m[39m[2m[11:32:31.025][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å…³è”åˆ°æŒ‡å®šçš„ç§‘ç›®
[22m[39m[2m[11:32:31.025][0m [36mDEBUG[0m [34m(api:analyze)[0m: Inferred subject
    [2msubjectName:[0m [37mmath[0m
    [2msubjectDisplayName:[0m [37mç‰©ç†[0m
[2m[11:32:31.025][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mæ•¸å­¸[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å…³è”åˆ°æŒ‡å®šçš„ç§‘ç›®
[22m[39m[2m[11:32:31.025][0m [36mDEBUG[0m [34m(api:analyze)[0m: AI returned knowledge points
    [2mknowledgePointsCount:[0m [37m1[0m
    [2mknowledgePointsType:[0m [37mobject[0m
    [2misArray:[0m [37mtrue[0m
[2m[11:32:31.025][0m [32mINFO [0m [34m(api:analyze)[0m: AI analysis successful

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒè‹±æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.026][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒè‹±æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.026][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37men[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.026][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒè‹±æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.026][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.026][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ”¯æŒè‹±æ–‡è¯­è¨€
[22m[39m[2m[11:32:31.026][0m [36mDEBUG[0m [34m(api:analyze)[0m: AI returned knowledge points
    [2mknowledgePointsCount:[0m [37m1[0m
    [2mknowledgePointsType:[0m [37mobject[0m
    [2misArray:[0m [37mtrue[0m
[2m[11:32:31.026][0m [32mINFO [0m [34m(api:analyze)[0m: AI analysis successful

[90mstderr[2m | src/__tests__/integration/practice.test.ts[2m > [22m[2m/api/practice[2m > [22m[2mPOST /api/practice/generate (ç”Ÿæˆç±»ä¼¼é¢˜ç›®)[2m > [22m[2måº”è¯¥å¤„ç† AI æœåŠ¡é”™è¯¯
[22m[39m[2m[11:32:31.026][0m [31mERROR[0m [34m(api:practice:generate)[0m: Error generating practice
    [2merror:[0m [37mAI service unavailable[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è®¤è¯é”™è¯¯
[22m[39m[2m[11:32:31.027][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è®¤è¯é”™è¯¯
[22m[39m[2m[11:32:31.027][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.027][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è®¤è¯é”™è¯¯
[22m[39m[2m[11:32:31.027][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.027][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstderr[2m | src/__tests__/integration/practice.test.ts[2m > [22m[2m/api/practice[2m > [22m[2mPOST /api/practice/record (è®°å½•ç»ƒä¹ ç»“æœ)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.029][0m [31mERROR[0m [34m(api:practice:record)[0m: Error saving practice record
    [2merror:[0m [37mDatabase connection failed[0m

[90mstderr[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è®¤è¯é”™è¯¯
[22m[39m[2m[11:32:31.029][0m [31mERROR[0m [34m(api:analyze)[0m: Analysis error occurred
    [2merror:[0m [37mAI_AUTH_ERROR: Invalid API key[0m
    [2mstack:[0m [37mError: AI_AUTH_ERROR: Invalid API key
    at D:/MyApp/wrong-notebook/src/__tests__/integration/analyze.test.ts:200:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

 [32mâœ“[39m src/__tests__/integration/practice.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è¿æ¥é”™è¯¯
[22m[39m[2m[11:32:31.030][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è¿æ¥é”™è¯¯
[22m[39m[2m[11:32:31.030][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.030][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è¿æ¥é”™è¯¯
[22m[39m[2m[11:32:31.030][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.030][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstderr[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI è¿æ¥é”™è¯¯
[22m[39m[2m[11:32:31.030][0m [31mERROR[0m [34m(api:analyze)[0m: Analysis error occurred
    [2merror:[0m [37mAI_CONNECTION_FAILED[0m
    [2mstack:[0m [37mError: AI_CONNECTION_FAILED
    at D:/MyApp/wrong-notebook/src/__tests__/integration/analyze.test.ts:221:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI å“åº”é”™è¯¯
[22m[39m[2m[11:32:31.031][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI å“åº”é”™è¯¯
[22m[39m[2m[11:32:31.031][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.031][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI å“åº”é”™è¯¯
[22m[39m[2m[11:32:31.031][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.031][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstderr[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† AI å“åº”é”™è¯¯
[22m[39m[2m[11:32:31.031][0m [31mERROR[0m [34m(api:analyze)[0m: Analysis error occurred
    [2merror:[0m [37mAI_RESPONSE_ERROR[0m
    [2mstack:[0m [37mError: AI_RESPONSE_ERROR
    at D:/MyApp/wrong-notebook/src/__tests__/integration/analyze.test.ts:242:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† Zod éªŒè¯é”™è¯¯
[22m[39m[2m[11:32:31.032][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† Zod éªŒè¯é”™è¯¯
[22m[39m[2m[11:32:31.032][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.032][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† Zod éªŒè¯é”™è¯¯
[22m[39m[2m[11:32:31.032][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.032][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstderr[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç† Zod éªŒè¯é”™è¯¯
[22m[39m[2m[11:32:31.032][0m [31mERROR[0m [34m(api:analyze)[0m: Analysis error occurred
    [2merror:[0m [37mZod validation failed[0m
    [2mstack:[0m [37mError: Zod validation failed
    at D:/MyApp/wrong-notebook/src/__tests__/integration/analyze.test.ts:263:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç†æœªçŸ¥é”™è¯¯
[22m[39m[2m[11:32:31.033][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç†æœªçŸ¥é”™è¯¯
[22m[39m[2m[11:32:31.033][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.033][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç†æœªçŸ¥é”™è¯¯
[22m[39m[2m[11:32:31.033][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.033][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstderr[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥å¤„ç†æœªçŸ¥é”™è¯¯
[22m[39m[2m[11:32:31.033][0m [31mERROR[0m [34m(api:analyze)[0m: Analysis error occurred
    [2merror:[0m [37mUnknown error[0m
    [2mstack:[0m [37mError: Unknown error
    at D:/MyApp/wrong-notebook/src/__tests__/integration/analyze.test.ts:284:17
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///D:/MyApp/wrong-notebook/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)
    at runTest (file:///D:/MyApp/wrong-notebook/node_modules/@vitest/runner/dist/index.js:1650:12)[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ ‡å‡†åŒ–çŸ¥è¯†ç‚¹æ ‡ç­¾
[22m[39m[2m[11:32:31.034][0m [32mINFO [0m [34m(api:analyze)[0m: Analyze API called

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ ‡å‡†åŒ–çŸ¥è¯†ç‚¹æ ‡ç­¾
[22m[39m[2m[11:32:31.034][0m [36mDEBUG[0m [34m(api:analyze)[0m: Request received
    [2mimageLength:[0m [37m29[0m
    [2mmimeType:[0m [37mundefined[0m
    [2mlanguage:[0m [37mzh[0m
    [2msubjectId:[0m [37mundefined[0m
[2m[11:32:31.034][0m [36mDEBUG[0m [34m(api:analyze)[0m: Parsed Data URL
    [2mmimeType:[0m [37mimage/png[0m
    [2mbase64Length:[0m [37m7[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ ‡å‡†åŒ–çŸ¥è¯†ç‚¹æ ‡ç­¾
[22m[39m[2m[11:32:31.034][0m [36mDEBUG[0m [34m(api:analyze)[0m: Calculated user grade
    [2muserGrade:[0m [37m7[0m
[2m[11:32:31.034][0m [32mINFO [0m [34m(api:analyze)[0m: Calling AI service for image analysis
    [2muserGrade:[0m [37m7[0m
    [2msubject:[0m [37mnull[0m

[90mstdout[2m | src/__tests__/integration/analyze.test.ts[2m > [22m[2m/api/analyze[2m > [22m[2mPOST /api/analyze (å›¾åƒåˆ†æ)[2m > [22m[2måº”è¯¥æ ‡å‡†åŒ–çŸ¥è¯†ç‚¹æ ‡ç­¾
[22m[39m[2m[11:32:31.034][0m [36mDEBUG[0m [34m(api:analyze)[0m: AI returned knowledge points
    [2mknowledgePointsCount:[0m [37m2[0m
    [2mknowledgePointsType:[0m [37mobject[0m
    [2misArray:[0m [37mtrue[0m
[2m[11:32:31.034][0m [32mINFO [0m [34m(api:analyze)[0m: AI analysis successful

 [32mâœ“[39m src/__tests__/integration/analyze.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/notebooks.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstderr[2m | src/__tests__/integration/tags.test.ts[2m > [22m[2m/api/tags[2m > [22m[2mGET /api/tags/stats (æ ‡ç­¾ç»Ÿè®¡)[2m > [22m[2måº”è¯¥å¤„ç†æ— æ•ˆçš„ JSON çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.084][0m [33mWARN [0m [34m(api:tags:stats)[0m: Failed to parse knowledgePoints for item
    [2mknowledgePoints:[0m [37minvalid json{[0m

[90mstderr[2m | src/__tests__/integration/tags.test.ts[2m > [22m[2m/api/tags[2m > [22m[2mGET /api/tags/stats (æ ‡ç­¾ç»Ÿè®¡)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.086][0m [31mERROR[0m [34m(api:tags:stats)[0m: Error getting tag stats
    [2merror:[0m [37mDatabase connection failed[0m

[90mstderr[2m | src/__tests__/integration/tags.test.ts[2m > [22m[2m/api/tags[2m > [22m[2mGET /api/tags/suggestions (æ ‡ç­¾å»ºè®®)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.090][0m [31mERROR[0m [34m(api:tags:suggestions)[0m: Error getting tag suggestions
    [2merror:[0m [37mDatabase connection failed[0m

[90mstderr[2m | src/__tests__/integration/settings.test.ts[2m > [22m[2m/api/settings[2m > [22m[2mPOST /api/settings[2m > [22m[2måº”è¯¥å¤„ç†æ›´æ–°å¤±è´¥çš„æƒ…å†µ
[22m[39m[2m[11:32:31.090][0m [31mERROR[0m [34m(api:settings)[0m: Failed to update settings
    [2merror:[0m [37mWrite failed[0m

 [32mâœ“[39m src/__tests__/integration/tags.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/settings.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api-errors.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.104][0m [32mINFO [0m [34m(api:error-items)[0m: POST /api/error-items called

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.106][0m [36mDEBUG[0m [34m(api:error-items)[0m: Request parameters received
    [2mhasQuestionText:[0m [37mtrue[0m
    [2mquestionTextLength:[0m [37m12[0m
    [2mhasAnswerText:[0m [37mtrue[0m
    [2mhasAnalysis:[0m [37mtrue[0m
    [2mknowledgePointsCount:[0m [37m2[0m
    [2mhasImage:[0m [37mtrue[0m
    [2mimageSize:[0m [37m29[0m
    [2msubjectId:[0m [37mundefined[0m
    [2mgradeSemester:[0m [37mundefined[0m
    [2mpaperLevel:[0m [37mundefined[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.106][0m [36mDEBUG[0m [34m(api:error-items)[0m: User lookup result
    [2muserId:[0m [37muser-123[0m
    [2memail:[0m [37muser@example.com[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.107][0m [36mDEBUG[0m [34m(api:error-items)[0m: Grade calculated
    [2mfinalGradeSemester:[0m [37måˆä¸€ï¼Œä¸ŠæœŸ[0m
    [2meducationStage:[0m [37mjunior_high[0m
    [2menrollmentYear:[0m [37m2024[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.107][0m [36mDEBUG[0m [34m(api:error-items)[0m: Subject inferred
    [2msubjectId:[0m [37mundefined[0m
    [2msubjectName:[0m [37mundefined[0m
    [2msubjectKey:[0m [37mother[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.107][0m [36mDEBUG[0m [34m(api:error-items)[0m: Existing tag found
    [2mtagId:[0m [37mtag-ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹[0m
    [2mtagName:[0m [37mä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹[0m
    [2misSystem:[0m [37mfalse[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.107][0m [36mDEBUG[0m [34m(api:error-items)[0m: Existing tag found
    [2mtagId:[0m [37mtag-ç§»é¡¹[0m
    [2mtagName:[0m [37mç§»é¡¹[0m
    [2misSystem:[0m [37mfalse[0m
[2m[11:32:31.107][0m [32mINFO [0m [34m(api:error-items)[0m: Creating ErrorItem with tags
    [2mtagNames:[0m [37m[
  "ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹",
  "ç§»é¡¹"
][0m
    [2mtagConnectionsCount:[0m [37m2[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.107][0m [32mINFO [0m [34m(api:error-items)[0m: ErrorItem created successfully
    [2merrorItemId:[0m [37merror-item-1[0m
    [2mtagsCount:[0m [37m0[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶å…³è”åˆ°ç§‘ç›®
[22m[39m[2m[11:32:31.110][0m [32mINFO [0m [34m(api:error-items)[0m: POST /api/error-items called

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶å…³è”åˆ°ç§‘ç›®
[22m[39m[2m[11:32:31.110][0m [36mDEBUG[0m [34m(api:error-items)[0m: Request parameters received
    [2mhasQuestionText:[0m [37mtrue[0m
    [2mquestionTextLength:[0m [37m8[0m
    [2mhasAnswerText:[0m [37mtrue[0m
    [2mhasAnalysis:[0m [37mtrue[0m
    [2mknowledgePointsCount:[0m [37m1[0m
    [2mhasImage:[0m [37mtrue[0m
    [2mimageSize:[0m [37m29[0m
    [2msubjectId:[0m [37msubject-math-id[0m
    [2mgradeSemester:[0m [37mundefined[0m
    [2mpaperLevel:[0m [37mundefined[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶å…³è”åˆ°ç§‘ç›®
[22m[39m[2m[11:32:31.110][0m [36mDEBUG[0m [34m(api:error-items)[0m: User lookup result
    [2muserId:[0m [37muser-123[0m
    [2memail:[0m [37muser@example.com[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶å…³è”åˆ°ç§‘ç›®
[22m[39m[2m[11:32:31.110][0m [36mDEBUG[0m [34m(api:error-items)[0m: Grade calculated
    [2mfinalGradeSemester:[0m [37måˆä¸€ï¼Œä¸ŠæœŸ[0m
    [2meducationStage:[0m [37mjunior_high[0m
    [2menrollmentYear:[0m [37m2024[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶å…³è”åˆ°ç§‘ç›®
[22m[39m[2m[11:32:31.110][0m [36mDEBUG[0m [34m(api:error-items)[0m: Subject inferred
    [2msubjectId:[0m [37msubject-math-id[0m
    [2msubjectName:[0m [37mundefined[0m
    [2msubjectKey:[0m [37mother[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶å…³è”åˆ°ç§‘ç›®
[22m[39m[2m[11:32:31.110][0m [36mDEBUG[0m [34m(api:error-items)[0m: Existing tag found
    [2mtagId:[0m [37mtag-åŠ æ³•[0m
    [2mtagName:[0m [37måŠ æ³•[0m
    [2misSystem:[0m [37mfalse[0m
[2m[11:32:31.110][0m [32mINFO [0m [34m(api:error-items)[0m: Creating ErrorItem with tags
    [2mtagNames:[0m [37m[
  "åŠ æ³•"
][0m
    [2mtagConnectionsCount:[0m [37m1[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶å…³è”åˆ°ç§‘ç›®
[22m[39m[2m[11:32:31.110][0m [32mINFO [0m [34m(api:error-items)[0m: ErrorItem created successfully
    [2merrorItemId:[0m [37merror-item-2[0m
    [2mtagsCount:[0m [37m0[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶è®¾ç½®å¹´çº§å­¦æœŸ
[22m[39m[2m[11:32:31.111][0m [32mINFO [0m [34m(api:error-items)[0m: POST /api/error-items called

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶è®¾ç½®å¹´çº§å­¦æœŸ
[22m[39m[2m[11:32:31.111][0m [36mDEBUG[0m [34m(api:error-items)[0m: Request parameters received
    [2mhasQuestionText:[0m [37mtrue[0m
    [2mquestionTextLength:[0m [37m4[0m
    [2mhasAnswerText:[0m [37mtrue[0m
    [2mhasAnalysis:[0m [37mtrue[0m
    [2mknowledgePointsCount:[0m [37m1[0m
    [2mhasImage:[0m [37mtrue[0m
    [2mimageSize:[0m [37m29[0m
    [2msubjectId:[0m [37mundefined[0m
    [2mgradeSemester:[0m [37måˆä¸€ä¸ŠæœŸ[0m
    [2mpaperLevel:[0m [37mA[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶è®¾ç½®å¹´çº§å­¦æœŸ
[22m[39m[2m[11:32:31.111][0m [36mDEBUG[0m [34m(api:error-items)[0m: User lookup result
    [2muserId:[0m [37muser-123[0m
    [2memail:[0m [37muser@example.com[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶è®¾ç½®å¹´çº§å­¦æœŸ
[22m[39m[2m[11:32:31.111][0m [36mDEBUG[0m [34m(api:error-items)[0m: Subject inferred
    [2msubjectId:[0m [37mundefined[0m
    [2msubjectName:[0m [37mundefined[0m
    [2msubjectKey:[0m [37mother[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶è®¾ç½®å¹´çº§å­¦æœŸ
[22m[39m[2m[11:32:31.111][0m [36mDEBUG[0m [34m(api:error-items)[0m: Existing tag found
    [2mtagId:[0m [37mtag-æ–¹ç¨‹[0m
    [2mtagName:[0m [37mæ–¹ç¨‹[0m
    [2misSystem:[0m [37mfalse[0m
[2m[11:32:31.111][0m [32mINFO [0m [34m(api:error-items)[0m: Creating ErrorItem with tags
    [2mtagNames:[0m [37m[
  "æ–¹ç¨‹"
][0m
    [2mtagConnectionsCount:[0m [37m1[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸåˆ›å»ºé”™é¢˜å¹¶è®¾ç½®å¹´çº§å­¦æœŸ
[22m[39m[2m[11:32:31.111][0m [32mINFO [0m [34m(api:error-items)[0m: ErrorItem created successfully
    [2merrorItemId:[0m [37merror-item-3[0m
    [2mtagsCount:[0m [37m0[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»æœªç™»å½•ç”¨æˆ·åˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.112][0m [32mINFO [0m [34m(api:error-items)[0m: POST /api/error-items called

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»æœªç™»å½•ç”¨æˆ·åˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.112][0m [36mDEBUG[0m [34m(api:error-items)[0m: Request parameters received
    [2mhasQuestionText:[0m [37mtrue[0m
    [2mquestionTextLength:[0m [37m4[0m
    [2mhasAnswerText:[0m [37mfalse[0m
    [2mhasAnalysis:[0m [37mfalse[0m
    [2mknowledgePointsCount:[0m [37m0[0m
    [2mhasImage:[0m [37mtrue[0m
    [2mimageSize:[0m [37m4[0m
    [2msubjectId:[0m [37mundefined[0m
    [2mgradeSemester:[0m [37mundefined[0m
    [2mpaperLevel:[0m [37mundefined[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»æœªç™»å½•ç”¨æˆ·åˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.112][0m [36mDEBUG[0m [34m(api:error-items)[0m: User lookup result
    [2muserId:[0m [37mundefined[0m
    [2memail:[0m [37muser@example.com[0m

[90mstderr[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»æœªç™»å½•ç”¨æˆ·åˆ›å»ºé”™é¢˜
[22m[39m[2m[11:32:31.112][0m [33mWARN [0m [34m(api:error-items)[0m: User not found in DB
    [2msessionEmail:[0m [37muser@example.com[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥è‡ªåŠ¨è®¡ç®—å¹´çº§å­¦æœŸï¼ˆå¦‚æœæœªæä¾›ï¼‰
[22m[39m[2m[11:32:31.113][0m [32mINFO [0m [34m(api:error-items)[0m: POST /api/error-items called

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥è‡ªåŠ¨è®¡ç®—å¹´çº§å­¦æœŸï¼ˆå¦‚æœæœªæä¾›ï¼‰
[22m[39m[2m[11:32:31.113][0m [36mDEBUG[0m [34m(api:error-items)[0m: Request parameters received
    [2mhasQuestionText:[0m [37mtrue[0m
    [2mquestionTextLength:[0m [37m2[0m
    [2mhasAnswerText:[0m [37mtrue[0m
    [2mhasAnalysis:[0m [37mtrue[0m
    [2mknowledgePointsCount:[0m [37m1[0m
    [2mhasImage:[0m [37mtrue[0m
    [2mimageSize:[0m [37m29[0m
    [2msubjectId:[0m [37mundefined[0m
    [2mgradeSemester:[0m [37mundefined[0m
    [2mpaperLevel:[0m [37mundefined[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥è‡ªåŠ¨è®¡ç®—å¹´çº§å­¦æœŸï¼ˆå¦‚æœæœªæä¾›ï¼‰
[22m[39m[2m[11:32:31.113][0m [36mDEBUG[0m [34m(api:error-items)[0m: User lookup result
    [2muserId:[0m [37muser-123[0m
    [2memail:[0m [37muser@example.com[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥è‡ªåŠ¨è®¡ç®—å¹´çº§å­¦æœŸï¼ˆå¦‚æœæœªæä¾›ï¼‰
[22m[39m[2m[11:32:31.113][0m [36mDEBUG[0m [34m(api:error-items)[0m: Grade calculated
    [2mfinalGradeSemester:[0m [37måˆä¸€ï¼Œä¸ŠæœŸ[0m
    [2meducationStage:[0m [37mjunior_high[0m
    [2menrollmentYear:[0m [37m2024[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥è‡ªåŠ¨è®¡ç®—å¹´çº§å­¦æœŸï¼ˆå¦‚æœæœªæä¾›ï¼‰
[22m[39m[2m[11:32:31.113][0m [36mDEBUG[0m [34m(api:error-items)[0m: Subject inferred
    [2msubjectId:[0m [37mundefined[0m
    [2msubjectName:[0m [37mundefined[0m
    [2msubjectKey:[0m [37mother[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥è‡ªåŠ¨è®¡ç®—å¹´çº§å­¦æœŸï¼ˆå¦‚æœæœªæä¾›ï¼‰
[22m[39m[2m[11:32:31.113][0m [36mDEBUG[0m [34m(api:error-items)[0m: Existing tag found
    [2mtagId:[0m [37mtag-çŸ¥è¯†ç‚¹[0m
    [2mtagName:[0m [37mçŸ¥è¯†ç‚¹[0m
    [2misSystem:[0m [37mfalse[0m
[2m[11:32:31.113][0m [32mINFO [0m [34m(api:error-items)[0m: Creating ErrorItem with tags
    [2mtagNames:[0m [37m[
  "çŸ¥è¯†ç‚¹"
][0m
    [2mtagConnectionsCount:[0m [37m1[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥è‡ªåŠ¨è®¡ç®—å¹´çº§å­¦æœŸï¼ˆå¦‚æœæœªæä¾›ï¼‰
[22m[39m[2m[11:32:31.113][0m [32mINFO [0m [34m(api:error-items)[0m: ErrorItem created successfully
    [2merrorItemId:[0m [37merror-item-4[0m
    [2mtagsCount:[0m [37m0[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†å­—ç¬¦ä¸²æ ¼å¼çš„çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.114][0m [32mINFO [0m [34m(api:error-items)[0m: POST /api/error-items called

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†å­—ç¬¦ä¸²æ ¼å¼çš„çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.114][0m [36mDEBUG[0m [34m(api:error-items)[0m: Request parameters received
    [2mhasQuestionText:[0m [37mtrue[0m
    [2mquestionTextLength:[0m [37m2[0m
    [2mhasAnswerText:[0m [37mtrue[0m
    [2mhasAnalysis:[0m [37mtrue[0m
    [2mknowledgePointsCount:[0m [37m0[0m
    [2mhasImage:[0m [37mtrue[0m
    [2mimageSize:[0m [37m29[0m
    [2msubjectId:[0m [37mundefined[0m
    [2mgradeSemester:[0m [37mundefined[0m
    [2mpaperLevel:[0m [37mundefined[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†å­—ç¬¦ä¸²æ ¼å¼çš„çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.114][0m [36mDEBUG[0m [34m(api:error-items)[0m: User lookup result
    [2muserId:[0m [37muser-123[0m
    [2memail:[0m [37muser@example.com[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†å­—ç¬¦ä¸²æ ¼å¼çš„çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.114][0m [36mDEBUG[0m [34m(api:error-items)[0m: Grade calculated
    [2mfinalGradeSemester:[0m [37måˆä¸€ï¼Œä¸ŠæœŸ[0m
    [2meducationStage:[0m [37mjunior_high[0m
    [2menrollmentYear:[0m [37m2024[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†å­—ç¬¦ä¸²æ ¼å¼çš„çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.114][0m [36mDEBUG[0m [34m(api:error-items)[0m: Subject inferred
    [2msubjectId:[0m [37mundefined[0m
    [2msubjectName:[0m [37mundefined[0m
    [2msubjectKey:[0m [37mother[0m
[2m[11:32:31.114][0m [32mINFO [0m [34m(api:error-items)[0m: Creating ErrorItem with tags
    [2mtagNames:[0m [37m[][0m
    [2mtagConnectionsCount:[0m [37m0[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPOST /api/error-items (åˆ›å»ºé”™é¢˜)[2m > [22m[2måº”è¯¥æ­£ç¡®å¤„ç†å­—ç¬¦ä¸²æ ¼å¼çš„çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.114][0m [32mINFO [0m [34m(api:error-items)[0m: ErrorItem created successfully
    [2merrorItemId:[0m [37merror-item-5[0m
    [2mtagsCount:[0m [37m0[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPUT /api/error-items/[id] (æ›´æ–°é”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸæ›´æ–°çŸ¥è¯†ç‚¹
[22m[39m[2m[11:32:31.116][0m [32mINFO [0m [34m(api:error-items:id)[0m: Updating error item
    [2mid:[0m [37merror-item-1[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPUT /api/error-items/[id] (æ›´æ–°é”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸæ›´æ–°å¹´çº§å­¦æœŸ
[22m[39m[2m[11:32:31.116][0m [32mINFO [0m [34m(api:error-items:id)[0m: Updating error item
    [2mid:[0m [37merror-item-1[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPUT /api/error-items/[id] (æ›´æ–°é”™é¢˜)[2m > [22m[2måº”è¯¥æˆåŠŸæ›´æ–°è¯•å·ç­‰çº§
[22m[39m[2m[11:32:31.117][0m [32mINFO [0m [34m(api:error-items:id)[0m: Updating error item
    [2mid:[0m [37merror-item-1[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPATCH /api/error-items/[id]/notes (æ›´æ–°ç¬”è®°)[2m > [22m[2måº”è¯¥æ‹’ç»æœªç™»å½•ç”¨æˆ·
[22m[39m[2m[11:32:31.123][0m [36mDEBUG[0m [34m(api:error-items:notes)[0m: No session or user found, attempting fallback to first user

[90mstderr[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPATCH /api/error-items/[id]/notes (æ›´æ–°ç¬”è®°)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.123][0m [31mERROR[0m [34m(api:error-items:notes)[0m: Error updating notes
    [2merror:[0m [37mDatabase error[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPATCH /api/error-items/[id]/mastery (æ›´æ–°æŒæ¡ç¨‹åº¦)[2m > [22m[2måº”è¯¥æ‹’ç»æœªç™»å½•ç”¨æˆ·
[22m[39m[2m[11:32:31.124][0m [36mDEBUG[0m [34m(api:error-items:mastery)[0m: No session or user found, attempting fallback to first user

 [32mâœ“[39m src/__tests__/integration/admin-users.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstderr[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mPATCH /api/error-items/[id]/mastery (æ›´æ–°æŒæ¡ç¨‹åº¦)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.125][0m [31mERROR[0m [34m(api:error-items:mastery)[0m: Error updating item
    [2merror:[0m [37mDatabase error[0m

[90mstdout[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mDELETE /api/error-items/[id]/delete (åˆ é™¤é”™é¢˜)[2m > [22m[2måº”è¯¥æ‹’ç»æœªç™»å½•ç”¨æˆ·
[22m[39m[2m[11:32:31.126][0m [36mDEBUG[0m [34m(api:error-items:delete)[0m: No session or user found, attempting fallback to first user

[90mstderr[2m | src/__tests__/integration/error-items.test.ts[2m > [22m[2m/api/error-items[2m > [22m[2mDELETE /api/error-items/[id]/delete (åˆ é™¤é”™é¢˜)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.126][0m [31mERROR[0m [34m(api:error-items:delete)[0m: Error deleting item
    [2merror:[0m [37mDatabase error[0m

 [32mâœ“[39m src/__tests__/integration/error-items.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 27[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/user.test.ts[2m > [22m[2m/api/user[2m > [22m[2mGET /api/user[2m > [22m[2måº”è¯¥è¿”å›ç”¨æˆ·ä¿¡æ¯
[22m[39m[2m[11:32:31.144][0m [36mDEBUG[0m [34m(api:user)[0m: Returning user profile
    [2muser:[0m [37m{
  "name": "Test User",
  "email": "test@example.com",
  "educationStage": "junior_high",
  "enrollmentYear": 2024
}[0m

 [32mâœ“[39m src/__tests__/integration/user.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/register.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstderr[2m | src/__tests__/integration/stats.test.ts[2m > [22m[2m/api/stats[2m > [22m[2mGET /api/stats/practice (è·å–ç»ƒä¹ ç»Ÿè®¡)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.738][0m [31mERROR[0m [34m(api:stats:practice)[0m: Error fetching practice stats
    [2merror:[0m [37mDatabase connection failed[0m

[90mstderr[2m | src/__tests__/integration/stats.test.ts[2m > [22m[2m/api/stats[2m > [22m[2mDELETE /api/stats/practice/clear (æ¸…é™¤ç»ƒä¹ è®°å½•)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.740][0m [31mERROR[0m [34m(api:stats:practice:clear)[0m: Error clearing practice stats
    [2merror:[0m [37mDatabase error[0m

[90mstderr[2m | src/__tests__/integration/stats.test.ts[2m > [22m[2m/api/stats[2m > [22m[2mDELETE /api/error-items/clear (æ¸…é™¤æ‰€æœ‰é”™é¢˜)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.742][0m [31mERROR[0m [34m(api:error-items:clear)[0m: Error clearing error data
    [2merror:[0m [37mDatabase error[0m

 [32mâœ“[39m src/__tests__/integration/stats.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstderr[2m | src/__tests__/integration/analytics.test.ts[2m > [22m[2m/api/analytics[2m > [22m[2mGET /api/analytics (è·å–åˆ†æç»Ÿè®¡)[2m > [22m[2måº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯
[22m[39m[2m[11:32:31.792][0m [31mERROR[0m [34m(api:analytics)[0m: Error fetching analytics
    [2merror:[0m [37mDatabase connection failed[0m

 [32mâœ“[39m src/__tests__/integration/analytics.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/ai/gemini-retry.test.ts[2m > [22m[2mGeminiProvider Retry Logic[2m > [22m[2mshould throw immediately on non-retryable error
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai/gemini-retry.test.ts[2m > [22m[2mGeminiProvider Retry Logic[2m > [22m[2mshould give up after max retries
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai/gemini-retry.test.ts[2m > [22m[2mGeminiProvider Retry Logic[2m > [22m[2mshould retry on 503 service unavailable
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

[90mstderr[2m | src/__tests__/unit/ai/gemini-retry.test.ts[2m > [22m[2mGeminiProvider Retry Logic[2m > [22m[2mshould retry on connection reset
[22m[39m[prompts] No prefetched tags provided, AI will tag freely

 [32mâœ“[39m src/__tests__/unit/ai/gemini-retry.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 12422[2mms[22m[39m
     [33m[2mâœ“[22m[39m should retry on network error and eventually succeed [33m 4674[2mms[22m[39m
     [33m[2mâœ“[22m[39m should give up after max retries [33m 4648[2mms[22m[39m
     [33m[2mâœ“[22m[39m should retry on 503 service unavailable [33m 1551[2mms[22m[39m
     [33m[2mâœ“[22m[39m should retry on connection reset [33m 1545[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 1 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/ai/azure-provider.test.ts[2m > [22mAzure OpenAI Provider å“åº”è§£æ[2m > [22mparseResponse[2m > [22måº”è¯¥æ­£ç¡®è§£æåŒ…å«æ‰€æœ‰å¿…éœ€æ ‡ç­¾çš„å“åº”
[31m[1mAssertionError[22m: expected [ 'äºŒæ¬¡å‡½æ•¸', 'å‡½æ•¸æœ€å€¼' ] to include 'äºŒæ¬¡å‡½æ•°'[39m
[36m [2mâ¯[22m src/__tests__/unit/ai/azure-provider.test.ts:[2m235:44[22m[39m
    [90m233| [39m            [34mexpect[39m(result[33m.[39manalysis)[33m.[39m[34mtoContain[39m([32m'äºŒæ¬¡å‡½æ•¸'[39m)[33m;[39m
    [90m234| [39m            [34mexpect[39m(result[33m.[39msubject)[33m.[39m[34mtoBe[39m([32m'æ•¸å­¸'[39m)[33m;[39m
    [90m235| [39m            [34mexpect[39m(result[33m.[39mknowledgePoints)[33m.[39m[34mtoContain[39m([32m'äºŒæ¬¡å‡½æ•°'[39m)[33m;[39m
    [90m   | [39m                                           [31m^[39m
    [90m236| [39m            [34mexpect[39m(result[33m.[39mknowledgePoints)[33m.[39m[34mtoContain[39m([32m'å‡½æ•°æœ€å€¼'[39m)[33m;[39m
    [90m237| [39m            [34mexpect[39m(result[33m.[39mrequiresImage)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m22 passed[39m[22m[90m (23)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m386 passed[39m[22m[90m (387)[39m
[2m   Start at [22m 11:32:27
[2m   Duration [22m 15.97s[2m (transform 2.78s, setup 785ms, import 6.29s, tests 13.10s, environment 71.07s)[22m

